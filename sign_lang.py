#!/usr/bin/env python3
import time
import numpy as np
from leap_hand_utils.dynamixel_client import DynamixelClient

# Define poses for letters A-Z + space
letter_poses = {
    'A': [3.2, 5.0, 3.5, 5.1, 3.0, 5.0, 3.6, 5.0, 2.9, 4.9, 3.8, 5.0, 3.2, 3.2, 4.2, 3.5],
    'B': [3.1, 3.1, 3.1, 3.1, 3.1, 3.2, 2.9, 3.3, 3.2, 3.2, 2.8, 3.5, 4.4, 7.9, 1.9, 2.3],
    'C': [3.1, 3.1, 4.8, 3.1, 3.0, 3.3, 4.4, 3.6, 3.2, 3.3, 4.4, 3.5, 4.5, 6.3, 3.1, 2.1],
    'D': [3.2, 3.1, 3.2, 3.1, 3.1, 3.2, 4.6, 4.3, 3.2, 5.3, 4.0, 3.2, 4.8, 6.4, 2.4, 2.1],
    'E': [3.2, 5.1, 3.1, 4.9, 3.1, 5.1, 2.9, 5.0, 2.9, 5.1, 3.1, 5.0, 4.3, 4.7, 4.8, 3.7],
    'F': [3.1, 4.9, 3.6, 4.9, 3.1, 3.4, 2.7, 3.3, 3.2, 3.4, 2.7, 3.1, 3.5, 3.9, 3.6, 4.3],
    'G': [3.1, 3.2, 3.3, 2.8, 3.1, 5.1, 3.5, 4.3, 3.1, 4.9, 3.8, 4.3, 3.2, 3.1, 4.5, 3.2],
    'H': [3.3, 3.1, 3.3, 2.8, 3.3, 3.3, 2.8, 3.2, 3.1, 5.3, 3.7, 4.3, 3.7, 4.9, 4.7, 4.2],
    'I': [3.2, 4.7, 4.3, 3.7, 3.0, 5.3, 2.8, 4.7, 3.2, 3.1, 3.0, 3.2, 3.2, 4.8, 4.0, 4.5],
    'J': [3.2, 5.2, 4.2, 3.7, 3.0, 5.3, 2.8, 4.7, 3.2, 4.5, 3.0, 3.2, 3.2, 4.8, 4.0, 4.5],
    'K': [2.9, 3.0, 3.0, 3.1, 3.4, 3.1, 3.1, 3.2, 3.2, 5.0, 3.8, 4.1, 4.2, 4.8, 4.1, 4.4],
    'L': [3.2, 3.1, 3.2, 3.0, 3.2, 5.1, 4.0, 3.5, 3.1, 5.3, 3.3, 4.1, 3.3, 4.7, 3.1, 3.1],
    'M': [2.6, 4.8, 3.0, 3.0, 3.1, 5.0, 2.7, 3.3, 3.6, 4.8, 2.7, 3.4, 4.0, 4.7, 4.9, 3.7],
    'N': [3.1, 3.3, 2.8, 3.2, 3.5, 3.9, 2.8, 3.3, 3.2, 2.9, 3.3, 3.0, 3.7, 4.7, 4.9, 3.8],
    'O': [3.1, 3.8, 4.6, 3.5, 3.0, 4.0, 4.3, 3.7, 3.2, 3.9, 4.4, 3.6, 4.6, 3.2, 2.9, 4.7],
    'P': [3.1, 3.0, 3.4, 3.0, 3.0, 4.7, 3.1, 3.2, 3.2, 5.3, 3.9, 3.5, 5.1, 3.1, 3.3, 4.8],
    'Q': [3.1, 4.7, 3.1, 3.3, 3.3, 5.3, 4.1, 3.2, 3.2, 5.3, 3.9, 3.5, 4.6, 3.1, 3.2, 3.1],
    'R': [3.0, 2.8, 2.8, 2.8, 3.2, 3.1, 4.6, 3.1, 3.2, 5.3, 3.9, 3.5, 4.7, 4.9, 3.4, 4.3],
    'S': [3.0, 5.3, 3.8, 3.8, 3.3, 5.3, 3.9, 3.9, 3.1, 5.3, 3.7, 3.9, 3.6, 5.0, 3.6, 4.8],
    'T': [3.3, 5.1, 4.0, 3.7, 3.1, 5.0, 4.1, 3.4, 3.9, 3.2, 3.2, 3.2, 3.3, 3.2, 3.2, 3.4],
    'U': [3.1, 3.2, 3.0, 2.8, 3.1, 5.1, 3.6, 3.8, 3.1, 3.0, 3.1, 3.2, 3.3, 5.0, 4.3, 4.3],
    'V': [2.6, 3.2, 3.0, 2.8, 3.7, 3.3, 2.7, 3.5, 3.2, 5.4, 4.0, 3.3, 3.3, 4.7, 2.5, 3.5],
    'W': [2.6, 3.0, 3.0, 2.8, 3.1, 3.2, 2.7, 3.5, 3.6, 3.1, 3.0, 3.2, 3.3, 4.7, 2.5, 3.5],
    'X': [3.3, 3.1, 3.0, 3.3, 3.3, 5.3, 4.0, 3.6, 3.3, 5.4, 4.0, 3.4, 4.5, 4.8, 3.3, 3.3],
    'Y': [3.2, 3.0, 2.9, 2.8, 3.1, 3.1, 3.2, 3.7, 3.1, 5.2, 3.8, 3.4, 3.3, 6.3, 4.5, 3.3],
    'Z': [1.6, 4.6, 2.5, 4.7, 3.2, 5.3, 3.5, 3.8, 3.2, 5.4, 3.6, 3.5, 3.4, 3.3, 2.9, 4.7],
    ' ': [3.0, 3.2, 3.1, 3.0, 3.2, 3.2, 2.9, 3.3, 3.1, 3.2, 2.9, 3.2, 3.2, 3.1, 3.8, 4.0]
}

# Motor IDs
motors = list(range(16))

def main():
    try:
        dxl_client = DynamixelClient(motors, '/dev/ttyUSB0', 4000000)
        dxl_client.connect()
        dxl_client.set_torque_enabled(motors, True)
        print("[INFO] Connected and torque enabled.")
        
        word = input("Enter a word to spell with the LEAP Hand: ").upper()

        for letter in word:
            if letter not in letter_poses:
                print(f"[WARN] Letter '{letter}' not in dictionary, skipping...")
                continue
            
            pose = np.array(letter_poses[letter])
            print(f"[INFO] Showing letter '{letter}'")
            dxl_client.write_desired_pos(motors, pose)
            time.sleep(2.0)  # Hold each letter for 2 seconds

        print("[INFO] Word displayed successfully.")

    except KeyboardInterrupt:
        print("\n[INFO] Keyboard interrupt received. Releasing motors...")

    except Exception as e:
        print(f"‚ùå Error: {e}")

    finally:
        dxl_client.set_torque_enabled(motors, False)
        print("[INFO] Torque disabled. Script ended.")

if __name__ == "__main__":
    main()
